Project - FactFlow ( Trust every answer, No facts, no answer. ,Proof before prose) 


LLM            → Gemini
Embeddings     → BGE-large (primary), fallback BGE-base
Vector DB      → Pinecone
Reranker       → BGE-reranker / rerank stage
Agents         → LangGraph
RAG Framework  → LangChain
Metadata DB    → MongoDB (Atlas or self-hosted)
Monitoring     → LangSmith (plus optional Maxim AI/Arize)
Evaluation     → RAGAS (plus optional Maxim AI/Arize)


flowchart TD

%% ===============================
%% USER ENTRY
%% ===============================
U[User Query]
U --> QP[Query Preprocessor Agent<br/>• Clean query<br/>• Intent detection<br/>• Normalize]

%% ===============================
%% RETRIEVAL
%% ===============================
QP --> RET[Retriever Agent<br/>• Embed query<br/>• Vector DB search<br/>• Top-K chunks]
RET --> DOCS[Retrieved Documents<br/>+ Metadata]

%% ===============================
%% GENERATION
%% ===============================
DOCS --> GEN[LLM Answer Generator Agent<br/>• Context assembly<br/>• Draft answer]

%% ===============================
%% VALIDATION & TRUST
%% ===============================
GEN --> VAL[Answer Validator Agent]

VAL --> SIM[Similarity Check]
VAL --> CNT[Source Count Check]
VAL --> AGE[Freshness Check]

SIM --> TS[Trust Score Calculator]
CNT --> TS
AGE --> TS

TS -->|Score ≥ Threshold| TRUSTED[Trusted Answer]
TS -->|Score < Threshold| UNTRUSTED[Untrusted Answer]

%% ===============================
%% TRUSTED PATH
%% ===============================
TRUSTED --> ATTACH[Attach Sources<br/>+ Versions<br/>+ Confidence Score]
ATTACH --> RESP[Return Answer]
RESP --> U

%% ===============================
%% UNTRUSTED PATH
%% ===============================
UNTRUSTED --> HALL[Hallucination Detector Agent]

HALL --> CLAIM[Extract Atomic Claims]
CLAIM --> VERIFY[Verify Claims Against Docs]

VERIFY -->|All Supported| SAFE[Safe Answer<br/>Low Confidence]
VERIFY -->|Unsupported Found| FLAG[Hallucination Flagged]

SAFE --> WARN[Warn User<br/>Low Confidence]
WARN --> U

%% ===============================
%% KNOWLEDGE REFRESH
%% ===============================
FLAG --> REFRESH[Knowledge Refresh Agent]

REFRESH --> DECIDE{Change Severity?}

DECIDE -->|Minor Change| PARTIAL[Partial Re-index]
DECIDE -->|Major Change| FULL[Full Re-index]

PARTIAL --> REINDEX[Update Vector DB]
FULL --> REINDEX

REINDEX --> META[Update Metadata Store<br/>• Version<br/>• Freshness<br/>• Trust History]

META --> RET

%% ===============================
%% DOCUMENT WATCHER (BACKGROUND)
%% ===============================
FS[Document Store] --> HASH[Generate Document Hash]
FS --> TIME[Read Timestamp]

HASH --> COMPARE[Compare with Stored Metadata]
TIME --> COMPARE

COMPARE -->|No Change| OK[Document Fresh]
COMPARE -->|Changed| STALE[Document Stale]

STALE --> ALERT[Notify Knowledge Refresh Agent]
ALERT --> REFRESH
